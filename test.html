<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Dashboard Admin AKITA</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="icon" type="image/png" href="icon.png" />
    <link rel="icon" type="image/png" href="icon.png" />
    <link rel="shortcut icon" href="icon.png" />
    <link rel="apple-touch-icon" href="icon.png" />

    <!-- Favicon standar untuk desktop -->
    <link rel="icon" type="image/png" href="icon.png" />
    <link rel="shortcut icon" href="icon.png" />

    <!-- iOS icons -->
    <link rel="apple-touch-icon" href="icon.png" />
    <link rel="apple-touch-icon-precomposed" href="icon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-title" content="Akita" />

    <!-- Android icons -->
    <link rel="manifest" href="manifest.json" />
    <meta name="mobile-web-app-title" content="Akita" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="theme-color" content="#3f51b5" />
    <style>
      .chart-container {
        position: relative;
        height: 280px;
        margin: 15px 0;
      }

      .chart-filters {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }

      .chart-filters select {
        padding: 6px 10px;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        background: white;
        font-size: 13px;
        cursor: pointer;
        min-width: 120px;
      }

      .chart-filters select:focus {
        outline: none;
        border-color: #667eea;
      }

      @media (max-width: 768px) {
        .chart-container {
          height: 220px;
        }

        .chart-filters {
          justify-content: center;
          gap: 8px;
        }

        .chart-filters select {
          font-size: 12px;
          padding: 5px 8px;
          min-width: 100px;
        }
      }

      /* Dashboard specific styles */
      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 15px;
        margin-bottom: 15px;
      }

      @media (max-width: 768px) {
        .dashboard-grid {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .dashboard-grid .card {
          margin-bottom: 12px;
        }
      }

      /* Ensure proper spacing for dashboard elements */
      #dashboard .card {
        margin-bottom: 15px;
      }

      #dashboard .stats-grid {
        margin-bottom: 20px;
      }

      /* PIC Analysis Grid */
      .pic-analysis-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      @media (max-width: 768px) {
        .pic-analysis-grid {
          grid-template-columns: 1fr;
          gap: 12px;
        }
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
      }

      .sidebar {
        width: 250px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-right: 1px solid rgba(255, 255, 255, 0.2);
        padding: 20px;
        height: 100vh;
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1000;
        transition: transform 0.3s ease;
      }

      .sidebar h2 {
        color: #fff;
        font-size: 24px;
        margin-bottom: 30px;
        text-align: center;
        font-weight: 600;
      }

      .sidebar a {
        display: block;
        color: #fff;
        text-decoration: none;
        margin-bottom: 15px;
        padding: 12px 16px;
        border-radius: 12px;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .sidebar a:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateX(5px);
      }

      .sidebar a.active {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.4);
      }

      .main-content {
        flex: 1;
        margin-left: 250px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(5px);
        min-height: 100vh;
      }

      .header {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .header h1 {
        color: #fff;
        font-size: 28px;
        margin-bottom: 10px;
      }

      .header p {
        color: rgba(255, 255, 255, 0.8);
        font-size: 16px;
      }

      .content-section {
        display: none;
      }

      .content-section.active {
        display: block;
      }

      .card {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 12px;
        padding: 18px;
        margin-bottom: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .card h2 {
        color: #333;
        margin-bottom: 15px;
        font-size: 20px;
        font-weight: 600;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        color: #555;
        font-weight: 500;
      }

      .form-group input,
      .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-right: 10px;
      }

      .btn-primary {
        background: #667eea;
        color: #fff;
      }

      .btn-primary:hover {
        background: #5a6fd8;
        transform: translateY(-2px);
      }

      .btn-secondary {
        background: #6c757d;
        color: #fff;
      }

      .btn-secondary:hover {
        background: #5a6268;
      }

      .btn-danger {
        background: #dc3545;
        color: #fff;
      }

      .btn-danger:hover {
        background: #c82333;
      }

      .btn-warning {
        background: #ffc107;
        color: #212529;
      }

      .btn-warning:hover {
        background: #e0a800;
      }

      .table-container {
        overflow-x: auto;
        border-radius: 10px;
        background: #fff;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }

      th {
        background: #667eea;
        color: #fff;
        padding: 15px;
        text-align: left;
        font-weight: 600;
      }

      td {
        padding: 12px 15px;
        border-bottom: 1px solid #e0e0e0;
      }

      tr:hover {
        background: #f8f9ff;
      }

      .filter-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .tab {
        padding: 10px 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 25px;
        background: rgba(255, 255, 255, 0.1);
        color: #000;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
      }

      .tab:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .tab.active {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(0, 0, 0, 0.5);
      }

      .hidden {
        display: none;
      }

      .form-row {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
      }

      .form-row .form-group {
        flex: 1;
        margin-bottom: 0;
      }

      .edit-form {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 12px;
        padding: 20px;
        margin-top: 20px;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        padding: 25px 20px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.2);
        min-height: 120px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .stat-card h3 {
        color: #fff;
        font-size: 22px;
        margin-bottom: 8px;
        font-weight: 600;
      }

      .stat-card p {
        color: rgba(255, 255, 255, 0.8);
        font-size: 13px;
      }

      /* Toast Notifications */
      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
      }

      .toast {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        padding: 16px 20px;
        margin-bottom: 10px;
        border-left: 4px solid #28a745;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        transform: translateX(400px);
        opacity: 0;
        transition: all 0.3s ease;
        min-width: 300px;
      }

      .toast.show {
        transform: translateX(0);
        opacity: 1;
      }

      .toast.error {
        border-left-color: #dc3545;
      }

      .toast.warning {
        border-left-color: #ffc107;
      }

      .toast-content {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .toast-icon {
        font-size: 20px;
      }

      .toast-message {
        color: #333;
        font-weight: 500;
        flex: 1;
      }

      .toast-close {
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
        color: #666;
        opacity: 0.7;
      }

      .toast-close:hover {
        opacity: 1;
      }

      /* Loading States */
      .btn.loading {
        position: relative;
        pointer-events: none;
        opacity: 0.7;
      }

      .btn.loading::before {
        content: "";
        position: absolute;
        left: 50%;
        top: 50%;
        width: 16px;
        height: 16px;
        margin: -8px 0 0 -8px;
        border: 2px solid transparent;
        border-top: 2px solid currentColor;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }

      .table-loading {
        position: relative;
        pointer-events: none;
        opacity: 0.6;
      }

      .table-loading::after {
        content: "Memuat data...";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.9);
        padding: 20px;
        border-radius: 8px;
        font-weight: 500;
        color: #666;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }

      /* Search Functionality */
      .search-container {
        margin-bottom: 20px;
        position: relative;
      }

      .search-box {
        width: 100%;
        max-width: 400px;
        padding: 12px 16px 12px 45px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 25px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        color: #000;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .search-box:focus {
        outline: none;
        border-color: rgba(255, 255, 255, 0.5);
        background: rgba(255, 255, 255, 0.2);
      }

      .search-box::placeholder {
        color: rgba(0, 0, 0, 0.6);
      }

      .search-icon {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: rgba(0, 0, 0, 0.6);
        font-size: 16px;
      }

      .search-clear {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: rgba(0, 0, 0, 0.6);
        cursor: pointer;
        font-size: 18px;
        display: none;
      }

      .search-clear:hover {
        color: rgba(0, 0, 0, 0.8);
      }

      .highlight {
        background-color: #ffeb3b;
        padding: 2px 4px;
        border-radius: 3px;
        font-weight: 600;
      }

      .no-results {
        text-align: center;
        padding: 40px 20px;
        color: #666;
        font-style: italic;
      }

      .no-results-icon {
        font-size: 48px;
        margin-bottom: 10px;
        opacity: 0.5;
      }

      .search-stats {
        margin-top: 10px;
        font-size: 12px;
        color: rgba(0, 0, 0, 0.6);
      }

      /* Hamburger Menu Button */
      .hamburger-btn {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1001;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        width: 45px;
        height: 45px;
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .hamburger-btn:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .hamburger-btn span {
        width: 20px;
        height: 2px;
        background: #fff;
        margin: 2px 0;
        transition: all 0.3s ease;
        border-radius: 2px;
      }

      .hamburger-btn.active span:nth-child(1) {
        transform: rotate(45deg) translate(4px, 4px);
      }

      .hamburger-btn.active span:nth-child(2) {
        opacity: 0;
      }

      .hamburger-btn.active span:nth-child(3) {
        transform: rotate(-45deg) translate(4px, -4px);
      }

      /* Sidebar Overlay */
      .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
        z-index: 999;
        display: none;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .sidebar-overlay.active {
        display: block;
        opacity: 1;
      }

      /* Responsive Design */
      @media (max-width: 1024px) {
        .hamburger-btn {
          display: flex;
        }

        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
          padding: 80px 20px 20px;
        }

        .stats-grid {
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 15px;
        }

        .form-row {
          flex-direction: column;
          gap: 0;
        }
      }

      @media (max-width: 768px) {
        .main-content {
          padding: 80px 15px 15px;
        }

        .header h1 {
          font-size: 24px;
        }

        .card {
          padding: 20px;
        }

        .table-container {
          overflow-x: auto;
        }

        .filter-tabs {
          flex-wrap: wrap;
          gap: 8px;
        }

        .tab {
          padding: 8px 16px;
          font-size: 14px;
        }

        .search-box {
          max-width: 100%;
        }

        .stats-grid {
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
          gap: 10px;
        }

        .stat-card {
          padding: 15px;
        }

        .stat-card h3 {
          font-size: 20px;
        }

        th,
        td {
          padding: 8px;
          font-size: 12px;
        }

        .btn {
          padding: 8px 12px;
          font-size: 12px;
          margin: 2px;
        }

        .stats-grid {
          grid-template-columns: 1fr 1fr;
          gap: 15px;
        }

        .stat-card {
          padding: 20px 15px;
          min-height: 100px;
        }

        .stat-card h3 {
          font-size: 26px !important;
          margin-bottom: 8px;
        }

        .stat-card p {
          font-size: 14px !important;
        }

        .card {
          padding: 20px !important;
        }

        .card h2 {
          font-size: 18px !important;
        }

        .btn {
          padding: 10px 16px !important;
          font-size: 14px !important;
          margin: 3px !important;
        }

        th,
        td {
          padding: 10px 8px !important;
          font-size: 13px !important;
        }
      }

      /* Text truncation for mobile tables */
      .table-container {
        overflow-x: visible;
      }

      table {
        table-layout: fixed;
        width: 100%;
      }

      td:nth-child(3) {
        /* Kolom Agenda */
        max-width: 120px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      td:nth-child(4) {
        /* Kolom PIC */
        max-width: 80px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      td:nth-child(5) {
        /* Kolom Tempat */
        max-width: 80px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      td:nth-child(6) {
        /* Kolom Aksi */
        min-width: 120px;
        text-align: center;
      }

      td:nth-child(6) .btn {
        display: block !important;
        width: 100% !important;
        margin: 2px 0 !important;
        padding: 8px 6px !important;
        font-size: 11px !important;
      }

      /* Hover to show full text on mobile */
      td:hover {
        overflow: visible;
        white-space: normal;
        word-wrap: break-word;
        position: relative;
        z-index: 10;
        background: #fff;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }

      @media (max-width: 480px) {
        th {
          padding: 8px 6px !important;
          font-size: 12px !important;
          font-weight: 600 !important;
        }
        .stat-card h3 {
          font-size: 28px !important;
          margin-bottom: 6px !important;
        }

        .stat-card p {
          font-size: 13px !important;
        }
        .search-container {
          margin-bottom: 15px !important;
        }

        .search-box {
          padding: 12px 16px 12px 40px !important;
          font-size: 14px !important;
          border-radius: 20px !important;
        }

        .search-icon {
          left: 12px !important;
          font-size: 14px !important;
        }
        .header {
          padding: 15px !important;
          margin-bottom: 20px !important;
        }

        .header h1 {
          font-size: 20px !important;
        }

        .header p {
          font-size: 14px !important;
        }
        .main-content {
          padding: 80px 15px 15px !important;
        }

        .header {
          padding: 20px !important;
        }

        .header h1 {
          font-size: 22px !important;
        }

        .card {
          padding: 20px !important;
          margin-bottom: 20px !important;
        }

        .card h2 {
          font-size: 20px !important;
          margin-bottom: 15px !important;
        }

        .stats-grid {
          grid-template-columns: 1fr !important;
          gap: 15px !important;
        }

        .stat-card {
          padding: 25px 20px !important;
          min-height: 100px !important;
        }

        .stat-card h3 {
          font-size: 32px !important;
          margin-bottom: 10px !important;
        }

        .stat-card p {
          font-size: 16px !important;
        }

        .filter-tabs {
          justify-content: center;
          flex-wrap: wrap;
        }

        .tab {
          padding: 12px 20px !important;
          font-size: 14px !important;
          margin: 5px !important;
        }

        .search-box {
          padding: 15px 16px 15px 45px !important;
          font-size: 16px !important;
        }

        .table-container {
          border-radius: 8px;
          font-size: 14px !important;
        }

        th,
        td {
          padding: 12px 8px !important;
          font-size: 14px !important;
        }

        .btn {
          padding: 10px 15px !important;
          font-size: 13px !important;
          margin: 3px !important;
          display: inline-block !important;
        }

        .form-group input,
        .form-group textarea {
          padding: 15px !important;
          font-size: 16px !important;
        }

        .form-group label {
          font-size: 14px !important;
          margin-bottom: 8px !important;
        }

        .toast {
          min-width: 280px;
          margin: 0 10px;
          font-size: 14px !important;
        }

        .chart-container {
          height: 250px !important;
          margin: 15px 0 !important;
        }

        .chart-filters select {
          padding: 12px 15px !important;
          font-size: 14px !important;
          min-width: auto !important;
          width: 100% !important;
          margin-bottom: 10px !important;
        }

        td:nth-child(3) {
          /* Kolom Agenda */
          max-width: 100px !important;
        }

        td:nth-child(4) {
          /* Kolom PIC */
          max-width: 60px !important;
        }

        td:nth-child(5) {
          /* Kolom Tempat */
          max-width: 60px !important;
        }
      }

      .legend-scale {
        display: flex;
        gap: 2px;
      }

      .legend-item {
        width: 12px;
        height: 12px;
        border-radius: 2px;
      }

      .insight-card {
        background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        margin: 10px 0;
      }

      .insight-title {
        font-size: 16px;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .insight-text {
        font-size: 14px;
        opacity: 0.9;
      }

      .metric-comparison {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .metric-item {
        text-align: center;
        padding: 15px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        backdrop-filter: blur(5px);
      }

      .metric-value {
        font-size: 24px;
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
      }

      .metric-label {
        font-size: 12px;
        color: #666;
        text-transform: uppercase;
      }

      .filter-tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 20px;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        padding: 0 10px;
      }

      .tab {
        padding: 12px 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 25px;
        background: rgba(255, 255, 255, 0.1);
        color: #000;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
        font-size: 14px;
        white-space: nowrap;
        text-align: center;
        backdrop-filter: blur(10px);
        min-width: fit-content;
      }

      .tab:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
      }

      .tab.active {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(0, 0, 0, 0.5);
        color: #333;
        font-weight: 600;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .status-badge {
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: 500;
        text-align: center;
        min-width: 80px;
        display: inline-block;
      }

      .status-selesai {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .status-ditunda {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }

      .status-batal {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .status-belum_selesai {
        background: #e2e3e5;
        color: #383d41;
        border: 1px solid #d6d8db;
      }

      /* Form Select Styles */
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        background: white;
        cursor: pointer;
        transition: border-color 0.3s ease;
      }

      .form-group select:focus {
        outline: none;
        border-color: #667eea;
      }

      /* File Input Styles */
      .form-group input[type="file"] {
        padding: 8px;
        border: 2px dashed #e0e0e0;
        background: #f9f9f9;
        cursor: pointer;
      }

      .form-group input[type="file"]:hover {
        border-color: #667eea;
        background: #f0f4ff;
      }

      /* Current Foto Preview */
      .current-foto {
        margin-top: 10px;
        padding: 10px;
        background: #f9f9f9;
        border-radius: 8px;
        border: 1px solid #e0e0e0;
      }

      .current-foto p {
        margin-bottom: 8px;
        font-size: 13px;
        color: #666;
      }

      .btn-info {
  background: #17a2b8;
  color: #fff;
}

.btn-success {
  background: #28a745;
  color: #fff;
}

.btn-success:hover {
  background: #218838;
}

.print-buttons {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  margin-top: 20px;
}

@media (max-width: 768px) {
  .print-buttons {
    justify-content: center;
    flex-direction: column;
  }
}

.btn-info:hover {
  background: #138496;
}

      /* Mobile Responsive for Status */
      @media (max-width: 768px) {
        .status-badge {
          font-size: 11px;
          padding: 3px 8px;
          min-width: 70px;
        }

        td:nth-child(5) {
          min-width: 90px;
        }
      }

      /* Print Styles */
@media print {
  .sidebar, .hamburger-btn, .sidebar-overlay, .btn, .filter-tabs, 
  .search-container, .header, .toast-container {
    display: none !important;
  }
  
  body {
    background: white !important;
    color: black !important;
  }
  
  .main-content {
    margin-left: 0 !important;
    padding: 20px !important;
  }
  
  .card {
    background: white !important;
    border: 1px solid #ccc !important;
    box-shadow: none !important;
    margin-bottom: 20px !important;
  }
  
  table {
    border-collapse: collapse !important;
  }
  
  th, td {
    border: 1px solid #ccc !important;
    padding: 8px !important;
  }
  
  .print-header {
    text-align: center;
    margin-bottom: 30px;
    border-bottom: 2px solid #000;
    padding-bottom: 20px;
  }
  
  .print-footer {
    margin-top: 30px;
    border-top: 1px solid #ccc;
    padding-top: 15px;
    font-size: 12px;
    text-align: right;
  }
}

/* Print Report Dialog */
.print-dialog {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  border-radius: 12px;
  padding: 25px;
  box-shadow: 0 10px 50px rgba(0,0,0,0.3);
  z-index: 10001;
  min-width: 400px;
  max-width: 500px;
  border: 1px solid #ddd;
}

.print-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 10000;
  backdrop-filter: blur(5px);
}

.print-dialog h3 {
  margin-bottom: 20px;
  color: #333;
  font-size: 20px;
  text-align: center;
}

.print-options {
  display: grid;
  gap: 15px;
  margin-bottom: 20px;
}

.print-option {
  padding: 15px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  background: #f9f9f9;
}

.print-option:hover {
  border-color: #667eea;
  background: #f0f4ff;
}

.print-option.selected {
  border-color: #667eea;
  background: #e6f0ff;
}

.print-option h4 {
  margin: 0 0 5px 0;
  color: #333;
  font-size: 16px;
}

.print-option p {
  margin: 0;
  color: #666;
  font-size: 13px;
}

.print-actions {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
}

.category-info {
  background: #fff3cd;
  border: 1px solid #ffeaa7;
  border-radius: 6px;
  padding: 10px;
  margin: 10px 0;
  font-size: 12px;
  color: #856404;
}
    </style>
  </head>

  <body>
    <!-- Mobile Hamburger Button -->
    <button class="hamburger-btn" onclick="toggleSidebar()">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" onclick="closeSidebar()"></div>

    <div class="sidebar" id="sidebar">
      <h2>Admin AKITA</h2>
      <a href="#" onclick="showSection('dashboard')" class="nav-link active"
        >📊 Dashboard</a
      >
      <a href="#" onclick="showSection('kelola')" class="nav-link"
        >📋 Kelola Agenda</a
      >
      <a href="#" onclick="showSection('tambah')" class="nav-link"
        >➕ Tambah Agenda</a
      >
      <a href="#" onclick="showSection('capaian')" class="nav-link"
        >✅ Capaian Agenda</a
      >
    </div>

    <div class="main-content">
      <div class="toast-container" id="toast-container"></div>
      <!-- Print Dialog -->
<div class="print-overlay" id="printOverlay" style="display: none;"></div>
<div class="print-dialog" id="printDialog" style="display: none;">
  <h3>Cetak Laporan Agenda</h3>
  
  <div class="print-options">
    <div class="print-option" data-type="weekly" onclick="selectPrintOption('weekly')">
      <h4>Laporan Mingguan</h4>
      <p>Cetak agenda untuk 7 hari ke depan dari hari ini</p>
    </div>
    
    <div class="print-option" data-type="rapat" onclick="selectPrintOption('rapat')">
      <h4>Agenda Rapat</h4>
      <p>Cetak agenda yang mengandung kata "rapat"</p>
    </div>
    
    <div class="print-option" data-type="perdin" onclick="selectPrintOption('perdin')">
      <h4>Perjalanan Dinas</h4>
      <p>Agenda di kanwil, kantor wilayah, jl., semarang, batang, pekalongan</p>
    </div>
    
    <div class="print-option" data-type="bimtek" onclick="selectPrintOption('bimtek')">
      <h4>Bimbingan Teknis</h4>
      <p>Agenda yang mengandung "bimbingan teknis" atau "bimtek"</p>
    </div>
  </div>

  <div class="category-info" id="categoryInfo" style="display: none;">
    <strong>Preview:</strong> <span id="categoryPreview">0 agenda ditemukan</span>
  </div>
  
  <div class="print-actions">
    <button type="button" class="btn btn-secondary" onclick="closePrintDialog()">Batal</button>
    <button type="button" class="btn btn-primary" id="printBtn" onclick="executePrint()" disabled>Cetak</button>
  </div>
</div>

      <div class="header">
        <h1>Agenda Kita</h1>
        <p>Sistem Manajemen Agenda Kantor</p>
      </div>

      <!-- Dashboard Section -->
      <div id="dashboard" class="content-section active">
        <!-- Stats Cards -->
        <div class="stats-grid">
          <div class="stat-card">
            <h3 id="total-agenda">0</h3>
            <p>Total Agenda</p>
          </div>
          <div class="stat-card">
            <h3 id="agenda-hari-ini">0</h3>
            <p>Agenda Hari Ini</p>
          </div>
          <div class="stat-card">
            <h3 id="agenda-minggu">0</h3>
            <p>Agenda Minggu Ini</p>
          </div>
        </div>

        <!-- Charts Grid -->
        <div class="dashboard-grid">
          <!-- Busy Days Analysis -->
          <div class="card">
            <h2>Analisa Hari Tersibuk</h2>
            <div class="chart-filters">
              <select id="monthFilter" onchange="updateChart()">
                <option value="all">Semua Bulan</option>
                <option value="1">Januari</option>
                <option value="2">Februari</option>
                <option value="3">Maret</option>
                <option value="4">April</option>
                <option value="5">Mei</option>
                <option value="6">Juni</option>
                <option value="7">Juli</option>
                <option value="8">Agustus</option>
                <option value="9">September</option>
                <option value="10">Oktober</option>
                <option value="11">November</option>
                <option value="12">Desember</option>
              </select>
              <select id="chartType" onchange="updateChart()">
                <option value="bar">Bar Chart</option>
                <option value="line">Line Chart</option>
                <option value="doughnut">Doughnut Chart</option>
              </select>
            </div>
            <div class="chart-container">
              <canvas id="busyDaysChart"></canvas>
            </div>
          </div>
        </div>

        <!-- PIC Analysis -->
        <div class="card">
          <h2>Analisa Beban Kerja PIC</h2>
          <div class="chart-filters">
            <select id="picPeriod" onchange="updatePICAnalysis()">
              <option value="month">Bulan Ini</option>
              <option value="quarter">Quarter Ini</option>
              <option value="year">Tahun Ini</option>
            </select>
          </div>
          <div class="pic-analysis-grid">
            <div class="chart-container">
              <canvas id="picWorkloadChart"></canvas>
            </div>
            <div class="chart-container">
              <canvas id="picEfficiencyChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Location Analysis -->
        <div class="card">
          <h2>Analisa Utilitas Tempat</h2>
          <div class="chart-filters">
            <button class="tab active" onclick="switchLocationView('usage')">
              Penggunaan Ruang
            </button>
            <button class="tab" onclick="switchLocationView('efficiency')">
              Efisiensi Ruang
            </button>
            <button class="tab" onclick="switchLocationView('peak')">
              Peak Hours
            </button>
          </div>
          <div class="chart-container">
            <canvas id="locationChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Kelola Agenda Section -->
      <div id="kelola" class="content-section">
        <div class="card">
          <h2>Kelola Agenda</h2>

          <div class="filter-tabs">
            <div class="tab active" onclick="filterAgenda('all')">Semua</div>
            <div class="tab" onclick="filterAgenda('today')">Hari Ini</div>
            <div class="tab" onclick="filterAgenda('week')">Mendatang</div>
          </div>

          <div class="search-container">
            <span class="search-icon">🔍</span>
            <input
              type="text"
              class="search-box"
              id="searchInput"
              placeholder="Cari agenda, PIC, atau tempat..."
            />
            <button
              class="search-clear"
              id="searchClear"
              onclick="clearSearch()"
            >
              ×
            </button>
            <div class="search-stats" id="searchStats"></div>
          </div>

          <div class="table-container">
            <table id="agenda-table">
              <thead>
                <tr>
                  <th>Tanggal</th>
                  <th>Jam</th>
                  <th>Agenda</th>
                  <th>PIC</th>
                  <th>Tempat</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div id="editForm" class="edit-form hidden">
            <h3>Edit Agenda</h3>
            <form onsubmit="submitEdit(event)">
              <input type="hidden" id="edit-id" />
              <div class="form-row">
                <div class="form-group">
                  <label>Tanggal</label>
                  <input type="date" id="edit-tanggal" required />
                </div>
                <div class="form-group">
                  <label>Jam</label>
                  <input type="text" id="edit-jam" placeholder="Jam" required />
                </div>
              </div>
              <div class="form-group">
                <label>Agenda</label>
                <input
                  type="text"
                  id="edit-agenda"
                  placeholder="Agenda"
                  required
                />
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>PIC</label>
                  <input type="text" id="edit-pic" placeholder="PIC" />
                </div>
                <div class="form-group">
                  <label>Tempat</label>
                  <input type="text" id="edit-tempat" placeholder="Tempat" />
                </div>
              </div>
              <button type="submit" class="btn btn-primary">Simpan</button>
              <button
                type="button"
                class="btn btn-secondary"
                onclick="cancelEdit()"
              >
                Batal
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- Tambah Agenda Section -->
      <div id="tambah" class="content-section">
        <div class="card">
          <h2>Tambah Agenda</h2>
          <form onsubmit="submitTambah(event)">
            <div class="form-row">
              <div class="form-group">
                <label>Tanggal</label>
                <input type="date" id="tanggal" required />
              </div>
              <div class="form-group">
                <label>Jam</label>
                <input
                  type="text"
                  id="jam"
                  placeholder="08.00 - 10.00"
                  required
                />
              </div>
            </div>
            <div class="form-group">
              <label>Agenda</label>
              <input
                type="text"
                id="agenda"
                placeholder="Masukkan agenda"
                required
              />
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>PIC</label>
                <input type="text" id="pic" placeholder="Person in Charge" />
              </div>
              <div class="form-group">
                <label>Tempat</label>
                <input type="text" id="tempat" placeholder="Lokasi kegiatan" />
              </div>
            </div>
            <button type="submit" class="btn btn-primary">Tambah Agenda</button>
          </form>
        </div>
      </div>

      <div id="capaian" class="content-section">
        <div class="card">
          <h2>Capaian Agenda</h2>
          

          <div class="filter-tabs">
            <div class="tab active" onclick="filterCapaian('all')">Semua</div>
            <div class="tab" onclick="filterCapaian('selesai')">Selesai</div>
            <div class="tab" onclick="filterCapaian('ditunda')">Ditunda</div>
            <div class="tab" onclick="filterCapaian('batal')">Batal</div>
            <div class="tab" onclick="filterCapaian('belum_selesai')">
              Belum Selesai
            </div>
          </div>

          <div class="search-container">
            <span class="search-icon">🔍</span>
            <input
              type="text"
              class="search-box"
              id="searchCapaianInput"
              placeholder="Cari agenda untuk update capaian..."
            />
            <button
              class="search-clear"
              id="searchCapaianClear"
              onclick="clearCapaianSearch()"
            >
              ×
            </button>
            <div class="search-stats" id="searchCapaianStats"></div>
          </div>

          <div class="table-container">
            <table id="capaian-table">
              <thead>
                <tr>
                  <th>Tanggal</th>
                  <th>Jam</th>
                  <th>Agenda</th>
                  <th>PIC</th>
                  <th>Status</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <!-- Form Update Capaian -->
          <div id="capaianForm" class="edit-form hidden">
            <h3>Update Capaian Agenda</h3>
            <form onsubmit="submitCapaian(event)">
              <input type="hidden" id="capaian-id" />

              <!-- Info Agenda -->
              <div class="form-group">
                <label>Agenda</label>
                <input
                  type="text"
                  id="capaian-agenda"
                  readonly
                  style="background: #f5f5f5"
                />
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Tanggal</label>
                  <input
                    type="text"
                    id="capaian-tanggal"
                    readonly
                    style="background: #f5f5f5"
                  />
                </div>
                <div class="form-group">
                  <label>PIC</label>
                  <input
                    type="text"
                    id="capaian-pic"
                    readonly
                    style="background: #f5f5f5"
                  />
                </div>
              </div>

              <!-- Status -->
              <div class="form-group">
                <label>Status Capaian *</label>
                <select id="capaian-status" required>
                  <option value="belum_selesai">Belum Selesai</option>
                  <option value="selesai">Selesai</option>
                  <option value="ditunda">Ditunda</option>
                  <option value="batal">Batal</option>
                </select>
              </div>

              <!-- Upload Foto -->
              <div class="form-group">
                <label>Foto Dokumentasi (opsional)</label>
                <input type="file" id="capaian-foto" accept="image/*" />
                <small style="color: #666; font-size: 12px"
                  >Format: JPG, PNG, maksimal 5MB</small
                >
                <div id="current-foto" class="current-foto hidden">
                  <p>Foto saat ini:</p>
                  <img
                    id="current-foto-preview"
                    style="
                      max-width: 200px;
                      max-height: 150px;
                      border-radius: 8px;
                    "
                  />
                </div>
              </div>

              <!-- Keterangan -->
              <div class="form-group">
                <label>Keterangan (opsional)</label>
                <textarea
                  id="capaian-keterangan"
                  placeholder="Tambahkan keterangan tentang capaian agenda..."
                  rows="4"
                ></textarea>
              </div>

              <button type="submit" class="btn btn-primary">
                Simpan Capaian
              </button>
              <button
                type="button"
                class="btn btn-secondary"
                onclick="cancelCapaian()"
              >
                Batal
              </button>
            </form>
          </div>
        </div>
      </div>

      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
  <div></div>
  <button class="btn btn-info" onclick="showPrintDialog()">📄 Cetak Laporan</button>
</div>
    </div>
    <script>
      // ===== GLOBAL VARIABLES =====
      let busyDaysChart = null;
      let picWorkloadChart = null;
      let picEfficiencyChart = null;
      let locationChart = null;
      let chartData = [];
      let searchQuery = "";
      let allAgendaData = [];
      let currentFilter = "all";

      // ===== API ENDPOINTS =====
      // ===== API ENDPOINTS =====
      const API_ENDPOINTS = {
        GET_AGENDA: "/api/get-agenda",
        ADD_AGENDA: "/api/add-agenda",
        EDIT_AGENDA: "/api/edit-agenda",
        DELETE_AGENDA: "/api/delete-agenda",
        GET_CAPAIAN: "/api/get-agenda", // Menggunakan endpoint yang sama
        UPDATE_CAPAIAN: "/api/edit-agenda", // Menggunakan endpoint yang sama
      };

      // ===== UTILITY FUNCTIONS =====
      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func.apply(this, args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      function formatDate(dateString) {
        const date = new Date(dateString);
        const options = {
          year: "numeric",
          month: "long",
          day: "numeric",
        };
        return date.toLocaleDateString("id-ID", options);
      }

      function getTodayDate() {
        const today = new Date();
        return today.toISOString().split("T")[0];
      }

      function getWeekFromNow() {
        const weekFromNow = new Date();
        weekFromNow.setDate(weekFromNow.getDate() + 7);
        return weekFromNow.toISOString().split("T")[0];
      }

      function escapeRegExp(string) {
        return string.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
      }

      // ===== TOAST NOTIFICATION SYSTEM =====
      function showToast(message, type = "success") {
        const container = document.getElementById("toast-container");
        const toast = document.createElement("div");
        toast.className = `toast ${type}`;

        const icons = {
          success: "✅",
          error: "❌",
          warning: "⚠️",
          info: "ℹ️",
        };

        toast.innerHTML = `
        <div class="toast-content">
          <span class="toast-icon">${icons[type]}</span>
          <span class="toast-message">${message}</span>
          <button class="toast-close" onclick="closeToast(this)">×</button>
        </div>
      `;

        container.appendChild(toast);
        setTimeout(() => toast.classList.add("show"), 100);
        setTimeout(() => closeToast(toast), 4000);
      }

      function closeToast(element) {
        const toast = element.closest ? element.closest(".toast") : element;
        toast.classList.remove("show");
        setTimeout(() => toast.remove(), 300);
      }

      // ===== LOADING STATE HELPERS =====
      function setButtonLoading(
        button,
        isLoading,
        loadingText = "Memproses..."
      ) {
        if (isLoading) {
          button.originalText = button.textContent;
          button.textContent = loadingText;
          button.classList.add("loading");
          button.disabled = true;
        } else {
          button.textContent = button.originalText;
          button.classList.remove("loading");
          button.disabled = false;
        }
      }

      function setTableLoading(tableId, isLoading) {
        const table = document.getElementById(tableId);
        if (isLoading) {
          table.classList.add("table-loading");
        } else {
          table.classList.remove("table-loading");
        }
      }

      // ===== SEARCH FUNCTIONALITY =====
      function initSearch() {
        const searchInput = document.getElementById("searchInput");
        const searchClear = document.getElementById("searchClear");

        if (!searchInput || !searchClear) return;

        searchInput.addEventListener("input", handleSearchInput);
        searchClear.style.display = "none";
      }

      const handleSearchInput = debounce(function (event) {
        searchQuery = event.target.value.toLowerCase().trim();
        const searchClear = document.getElementById("searchClear");

        if (searchQuery.length > 0) {
          searchClear.style.display = "block";
        } else {
          searchClear.style.display = "none";
        }

        displayFilteredAgenda();
      }, 300);

      function clearSearch() {
        const searchInput = document.getElementById("searchInput");
        const searchClear = document.getElementById("searchClear");
        const searchStats = document.getElementById("searchStats");

        if (searchInput) searchInput.value = "";
        if (searchClear) searchClear.style.display = "none";
        if (searchStats) searchStats.textContent = "";

        searchQuery = "";
        displayFilteredAgenda();
      }

      function searchAgenda(data, query) {
        if (!query || query.length === 0) return data;

        return data.filter((item) => {
          const searchableFields = [
            item.agenda || "",
            item.pic || "",
            item.tempat || "",
            item.tanggal || "",
            item.jam || "",
          ];

          const searchableText = searchableFields.join(" ").toLowerCase();
          const queryWords = query.split(" ").filter((word) => word.length > 0);

          return queryWords.every((word) => searchableText.includes(word));
        });
      }

      function highlightText(text, query) {
        if (!query || !text || query.length === 0) return text;

        const queryWords = query.split(" ").filter((word) => word.length > 0);
        let highlightedText = text;

        queryWords.forEach((word) => {
          const regex = new RegExp(`(${escapeRegExp(word)})`, "gi");
          highlightedText = highlightedText.replace(
            regex,
            '<span class="highlight">$1</span>'
          );
        });

        return highlightedText;
      }

      // ===== FILTER FUNCTIONALITY =====
      function filterAgenda(type) {
        currentFilter = type;

        document.querySelectorAll(".filter-tabs .tab").forEach((tab) => {
          tab.classList.remove("active");
        });

        event.target.classList.add("active");
        displayFilteredAgenda();
      }

      function filterAgendaData(data) {
        const today = getTodayDate();
        const weekFromNow = getWeekFromNow();

        switch (currentFilter) {
          case "today":
            return data.filter((item) => item.tanggal === today);
          case "week":
            return data.filter(
              (item) => item.tanggal >= today && item.tanggal <= weekFromNow
            );
          default:
            return data;
        }
      }
      // ===== SORTING FUNCTION =====
      function sortAgendaByDateTime(data) {
        return data.sort((a, b) => {
          // Pertama sort berdasarkan tanggal
          const dateA = new Date(a.tanggal);
          const dateB = new Date(b.tanggal);

          if (dateA.getTime() !== dateB.getTime()) {
            return dateB.getTime() - dateA.getTime(); // Descending by date
          }

          // Jika tanggal sama, sort berdasarkan jam
          const timeA = parseTime(a.jam);
          const timeB = parseTime(b.jam);

          return timeB - timeA; // Descending by time
        });
      }

      function parseTime(timeString) {
        if (!timeString) return 0;

        // Extract first time from formats like "08:00", "08.00", "08:00 - 10:00", etc.
        const timeMatch = timeString.match(/(\d{1,2})[:.:](\d{2})/);
        if (timeMatch) {
          const hours = parseInt(timeMatch[1]);
          const minutes = parseInt(timeMatch[2]);
          return hours * 60 + minutes; // Convert to minutes for comparison
        }

        return 0;
      }

      // ===== DISPLAY FUNCTIONS =====
      function displayFilteredAgenda() {
        const tbody = document.querySelector("#agenda-table tbody");
        const searchStats = document.getElementById("searchStats");

        if (!tbody) return;

        let filteredData = filterAgendaData(allAgendaData);

        if (searchQuery && searchQuery.length > 0) {
          filteredData = searchAgenda(filteredData, searchQuery);
        }

        // Sort data by date and time (descending)
        filteredData = sortAgendaByDateTime(filteredData);

        tbody.innerHTML = "";

        if (filteredData.length === 0) {
          const noResultsMessage = searchQuery
            ? `Tidak ditemukan agenda yang sesuai dengan "${searchQuery}"`
            : "Tidak ada agenda untuk filter yang dipilih";

          tbody.innerHTML = `
          <tr>
            <td colspan="6" class="no-results">
              <div class="no-results-icon">😔</div>
              <div>${noResultsMessage}</div>
            </td>
          </tr>
        `;

          updateSearchStats(searchStats, 0, allAgendaData.length);
          return;
        }

        filteredData.forEach((row) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
          <td title="${formatDate(row.tanggal)}">${highlightText(
            formatDate(row.tanggal),
            searchQuery
          )}</td>
          <td title="${row.jam}">${highlightText(row.jam, searchQuery)}</td>
          <td title="${row.agenda}">${highlightText(
            row.agenda,
            searchQuery
          )}</td>
          <td title="${row.pic || "Tidak ada PIC"}">${highlightText(
            row.pic || "Tidak ada PIC",
            searchQuery
          )}</td>
          <td title="${row.tempat || "Tidak ada lokasi"}">${highlightText(
            row.tempat || "Tidak ada lokasi",
            searchQuery
          )}</td>
          <td>
            <button onclick='editAgenda(${JSON.stringify(row).replace(
              /'/g,
              "&#39;"
            )})' class="btn btn-warning">Edit</button>
            <button onclick='deleteAgenda(${
              row.id
            })' class="btn btn-danger">Hapus</button>
          </td>
        `;
          tbody.appendChild(tr);
        });

        updateSearchStats(
          searchStats,
          filteredData.length,
          allAgendaData.length
        );
      }

      function updateSearchStats(searchStats, totalResults, totalData) {
        if (!searchStats) return;

        if (searchQuery && searchQuery.length > 0) {
          searchStats.textContent = `Menampilkan ${totalResults} dari ${totalData} agenda`;
        } else {
          searchStats.textContent = "";
        }
      }

      // ===== API FUNCTIONS =====
      async function loadAgenda() {
        setTableLoading("agenda-table", true);

        try {
          const response = await fetch(API_ENDPOINTS.GET_AGENDA);
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          allAgendaData = data || [];
          displayFilteredAgenda();
        } catch (error) {
          console.error("Error loading agenda:", error);
          showToast("Gagal memuat data agenda!", "error");
          allAgendaData = [];
          displayFilteredAgenda();
        } finally {
          setTableLoading("agenda-table", false);
        }
      }

      async function loadDashboardStats() {
        try {
          const response = await fetch(API_ENDPOINTS.GET_AGENDA);
          const data = await response.json();

          const today = getTodayDate();
          const weekFromNow = getWeekFromNow();

          const todayAgenda = data.filter((item) => item.tanggal === today);
          const weekAgenda = data.filter(
            (item) => item.tanggal >= today && item.tanggal <= weekFromNow
          );

          document.getElementById("total-agenda").textContent = data.length;
          document.getElementById("agenda-hari-ini").textContent =
            todayAgenda.length;
          document.getElementById("agenda-minggu").textContent =
            weekAgenda.length;

          chartData = data;
          createBusyDaysChart(data);
          createPICAnalysis(data);
          createLocationChart(data);
        } catch (error) {
          console.error("Error loading dashboard stats:", error);
          showToast("Gagal memuat statistik!", "error");
        }
      }

      async function submitTambah(e) {
        e.preventDefault();
        const submitBtn = e.target.querySelector('button[type="submit"]');
        setButtonLoading(submitBtn, true, "Menambahkan...");

        const formData = {
          tanggal: document.getElementById("tanggal").value,
          jam: document.getElementById("jam").value,
          agenda: document.getElementById("agenda").value,
          pic: document.getElementById("pic").value,
          tempat: document.getElementById("tempat").value,
        };

        try {
          const response = await fetch(API_ENDPOINTS.ADD_AGENDA, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          showToast("Agenda berhasil ditambahkan!", "success");
          e.target.reset();
          loadDashboardStats();
        } catch (error) {
          console.error("Error adding agenda:", error);
          showToast("Gagal menambahkan agenda!", "error");
        } finally {
          setButtonLoading(submitBtn, false);
        }
      }

      async function submitEdit(e) {
        e.preventDefault();
        const submitBtn = e.target.querySelector('button[type="submit"]');
        setButtonLoading(submitBtn, true, "Menyimpan...");

        const id = document.getElementById("edit-id").value;
        const data = {
          id: parseInt(id),
          tanggal: document.getElementById("edit-tanggal").value,
          jam: document.getElementById("edit-jam").value,
          agenda: document.getElementById("edit-agenda").value,
          pic: document.getElementById("edit-pic").value,
          tempat: document.getElementById("edit-tempat").value,
        };

        try {
          const response = await fetch(API_ENDPOINTS.EDIT_AGENDA, {
            method: "PATCH",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          showToast("Agenda berhasil diupdate!", "success");
          cancelEdit();
          loadAgenda();
          loadDashboardStats();
          // Scroll ke atas setelah berhasil simpan
          setTimeout(() => {
            window.scrollTo({
              top: 0,
              behavior: "smooth",
            });
          }, 200);
        } catch (error) {
          console.error("Error updating agenda:", error);
          showToast("Gagal mengupdate agenda!", "error");
        } finally {
          setButtonLoading(submitBtn, false);
        }
      }

      function editAgenda(data) {
        showSection("kelola");
        document.getElementById("editForm").classList.remove("hidden");
        document.getElementById("edit-id").value = data.id;
        document.getElementById("edit-tanggal").value = data.tanggal;
        document.getElementById("edit-jam").value = data.jam;
        document.getElementById("edit-agenda").value = data.agenda;
        document.getElementById("edit-pic").value = data.pic || "";
        document.getElementById("edit-tempat").value = data.tempat || "";

        // Scroll ke form edit
        setTimeout(() => {
          document.getElementById("editForm").scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
        }, 45);
      }

      function cancelEdit() {
        document.getElementById("editForm").classList.add("hidden");
        setTimeout(() => {
          window.scrollTo({
            top: 0,
            behavior: "smooth",
          });
        }, 100);
      }

      async function deleteAgenda(id) {
        if (!confirm("Yakin ingin menghapus agenda ini?")) return;

        const deleteBtn = event.target;
        setButtonLoading(deleteBtn, true, "Menghapus...");

        try {
          const response = await fetch(API_ENDPOINTS.DELETE_AGENDA, {
            method: "DELETE",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ id: parseInt(id) }),
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          showToast("Agenda berhasil dihapus!", "success");
          loadAgenda();
          loadDashboardStats();
        } catch (error) {
          console.error("Error deleting agenda:", error);
          showToast("Gagal menghapus agenda!", "error");
        } finally {
          setButtonLoading(deleteBtn, false);
        }
      }

      // ===== CHART FUNCTIONS =====
      function analyzeBusyDays(data) {
        const dayNames = [
          "Minggu",
          "Senin",
          "Selasa",
          "Rabu",
          "Kamis",
          "Jumat",
          "Sabtu",
        ];
        const dayCounts = [0, 0, 0, 0, 0, 0, 0];
        const monthFilter = document.getElementById("monthFilter").value;

        data.forEach((item) => {
          const date = new Date(item.tanggal);
          const month = date.getMonth() + 1;

          if (monthFilter !== "all" && month !== parseInt(monthFilter)) {
            return;
          }

          const dayIndex = date.getDay();
          dayCounts[dayIndex]++;
        });

        return {
          labels: dayNames,
          data: dayCounts,
        };
      }

      function getMonthName() {
        const monthFilter = document.getElementById("monthFilter").value;
        if (monthFilter === "all") return "(Semua Bulan)";

        const months = [
          "",
          "Januari",
          "Februari",
          "Maret",
          "April",
          "Mei",
          "Juni",
          "Juli",
          "Agustus",
          "September",
          "Oktober",
          "November",
          "Desember",
        ];

        return `(${months[parseInt(monthFilter)]})`;
      }

      function createBusyDaysChart(data) {
        const ctx = document.getElementById("busyDaysChart").getContext("2d");
        const chartType = document.getElementById("chartType").value;

        if (busyDaysChart) {
          busyDaysChart.destroy();
        }

        const analyzedData = analyzeBusyDays(data);
        const colors = [
          "#FF6384",
          "#36A2EB",
          "#FFCE56",
          "#4BC0C0",
          "#9966FF",
          "#FF9F40",
          "#FF6384",
        ];

        const config = {
          type: chartType,
          data: {
            labels: analyzedData.labels,
            datasets: [
              {
                label: "Jumlah Agenda",
                data: analyzedData.data,
                backgroundColor:
                  chartType === "doughnut"
                    ? colors
                    : "rgba(102, 126, 234, 0.8)",
                borderColor:
                  chartType === "doughnut" ? colors : "rgba(102, 126, 234, 1)",
                borderWidth: 2,
                tension: 0.4,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: chartType === "doughnut",
                position: "bottom",
              },
              title: {
                display: true,
                text: `Distribusi Agenda per Hari ${getMonthName()}`,
              },
            },
            scales:
              chartType !== "doughnut"
                ? {
                    y: {
                      beginAtZero: true,
                      ticks: {
                        stepSize: 1,
                      },
                    },
                  }
                : {},
          },
        };

        busyDaysChart = new Chart(ctx, config);
      }

      function analyzePICWorkload(data) {
        const picMap = {};

        data.forEach((item) => {
          const pic = item.pic || "Tidak Ada PIC";
          picMap[pic] = (picMap[pic] || 0) + 1;
        });

        const names = Object.keys(picMap);
        const counts = Object.values(picMap);
        const total = counts.reduce((a, b) => a + b, 0);
        const efficiency = counts.map((count) =>
          Math.round((count / total) * 100)
        );

        return { names, counts, efficiency };
      }

      function createPICAnalysis(data) {
        const picData = analyzePICWorkload(data);

        // Workload Chart
        const ctx1 = document
          .getElementById("picWorkloadChart")
          .getContext("2d");
        if (picWorkloadChart) picWorkloadChart.destroy();

        picWorkloadChart = new Chart(ctx1, {
          type: "bar",
          data: {
            labels: picData.names,
            datasets: [
              {
                label: "Jumlah Agenda",
                data: picData.counts,
                backgroundColor: "#4ecdc4",
                borderColor: "#26d0ce",
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: "Beban Kerja per PIC",
              },
            },
          },
        });

        // Efficiency Chart
        const ctx2 = document
          .getElementById("picEfficiencyChart")
          .getContext("2d");
        if (picEfficiencyChart) picEfficiencyChart.destroy();

        picEfficiencyChart = new Chart(ctx2, {
          type: "doughnut",
          data: {
            labels: picData.names,
            datasets: [
              {
                data: picData.efficiency,
                backgroundColor: [
                  "#ff9999",
                  "#66b3ff",
                  "#99ff99",
                  "#ffcc99",
                  "#ff99cc",
                ],
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: "Efisiensi PIC (%)",
              },
            },
          },
        });
      }

      function analyzeLocation(data, viewType) {
        const locationMap = {};

        data.forEach((item) => {
          const location = item.tempat || "Tidak Ada Lokasi";
          locationMap[location] = (locationMap[location] || 0) + 1;
        });

        const labels = Object.keys(locationMap);
        let chartData = Object.values(locationMap);

        if (viewType === "efficiency") {
          const max = Math.max(...chartData);
          chartData = chartData.map((value) => Math.round((value / max) * 100));
        }

        return { labels, data: chartData };
      }

      function createLocationChart(data, viewType = "usage") {
        const ctx = document.getElementById("locationChart").getContext("2d");
        if (locationChart) locationChart.destroy();

        const locationData = analyzeLocation(data, viewType);

        const config = {
          usage: {
            type: "bar",
            title: "Penggunaan Ruang",
            color: "#667eea",
          },
          efficiency: {
            type: "line",
            title: "Efisiensi Ruang (%)",
            color: "#4ecdc4",
          },
          peak: {
            type: "radar",
            title: "Peak Hours per Lokasi",
            color: "#ff6b6b",
          },
        };

        locationChart = new Chart(ctx, {
          type: config[viewType].type,
          data: {
            labels: locationData.labels,
            datasets: [
              {
                label: config[viewType].title,
                data: locationData.data,
                backgroundColor: config[viewType].color,
                borderColor: config[viewType].color,
                tension: 0.4,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: config[viewType].title,
              },
            },
          },
        });
      }

      function updateChart() {
        if (chartData.length > 0) {
          createBusyDaysChart(chartData);
        }
      }

      function updatePICAnalysis() {
        if (chartData.length > 0) {
          createPICAnalysis(chartData);
        }
      }

      function switchLocationView(viewType) {
        document
          .querySelectorAll(".tab")
          .forEach((tab) => tab.classList.remove("active"));
        event.target.classList.add("active");

        if (chartData.length > 0) {
          createLocationChart(chartData, viewType);
        }
      }

      // ===== NAVIGATION FUNCTIONS =====

      function showSection(id) {
        document
          .querySelectorAll(".nav-link")
          .forEach((link) => link.classList.remove("active"));
        if (event && event.target) {
          event.target.classList.add("active");
        }

        document
          .querySelectorAll(".content-section")
          .forEach((section) => section.classList.remove("active"));
        document.getElementById(id).classList.add("active");

        if (window.innerWidth <= 1024) {
          closeSidebar();
        }

        if (id === "kelola") {
          loadAgenda();
          setTimeout(() => {
            initSearch();
          }, 100);
        }

        if (id === "dashboard") {
          loadDashboardStats();
        }

        // TAMBAHKAN INI:
        if (id === "capaian") {
          loadCapaian();
          setTimeout(() => {
            initCapaianSearch();
          }, 100);
        }
      }

      // ===== SIDEBAR FUNCTIONS =====
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const hamburger = document.querySelector(".hamburger-btn");
        const overlay = document.querySelector(".sidebar-overlay");

        sidebar.classList.toggle("active");
        hamburger.classList.toggle("active");
        overlay.classList.toggle("active");
      }

      function closeSidebar() {
        const sidebar = document.getElementById("sidebar");
        const hamburger = document.querySelector(".hamburger-btn");
        const overlay = document.querySelector(".sidebar-overlay");

        sidebar.classList.remove("active");
        hamburger.classList.remove("active");
        overlay.classList.remove("active");
      }

      // ===== CAPAIAN AGENDA VARIABLES =====
      let allCapaianData = [];
      let currentCapaianFilter = "all";
      let searchCapaianQuery = "";

      // ===== CAPAIAN FUNCTIONS =====
      async function loadCapaian() {
  setTableLoading("capaian-table", true);
  console.log("=== LOADING CAPAIAN DATA ===");

  try {
    const response = await fetch(API_ENDPOINTS.GET_AGENDA);
    console.log("Load capaian response status:", response.status);
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();
    console.log("Raw capaian data from API:", data);
    console.log("Total items loaded:", data.length);
    
    // Pastikan setiap item memiliki status yang benar
    data.forEach((item, index) => {
      console.log(`Item ${index}: ID=${item.id}, Status="${item.status}", Agenda="${item.agenda}"`);
      
      // Jika status null atau undefined, set ke belum_selesai
      if (!item.status) {
        console.log(`Setting default status for item ${item.id}`);
        item.status = "belum_selesai";
      }
    });

    allCapaianData = data || [];
    console.log("Processed capaian data:", allCapaianData.length, "items");
    
    displayFilteredCapaian();
  } catch (error) {
    console.error("=== ERROR LOADING CAPAIAN ===");
    console.error("Error details:", error);
    showToast("Gagal memuat data capaian!", "error");
    allCapaianData = [];
    displayFilteredCapaian();
  } finally {
    setTableLoading("capaian-table", false);
  }
}

      function filterCapaian(type) {
        currentCapaianFilter = type;

        document
          .querySelectorAll("#capaian .filter-tabs .tab")
          .forEach((tab) => {
            tab.classList.remove("active");
          });

        event.target.classList.add("active");
        displayFilteredCapaian();
      }

      function filterCapaianData(data) {
        switch (currentCapaianFilter) {
          case "selesai":
            return data.filter((item) => item.status === "selesai");
          case "ditunda":
            return data.filter((item) => item.status === "ditunda");
          case "batal":
            return data.filter((item) => item.status === "batal");
          case "belum_selesai":
            return data.filter(
              (item) => !item.status || item.status === "belum_selesai"
            );
          default:
            return data;
        }
      }

      function searchCapaian(data, query) {
        if (!query || query.length === 0) return data;

        return data.filter((item) => {
          const searchableFields = [
            item.agenda || "",
            item.pic || "",
            item.tempat || "",
            item.tanggal || "",
          ];

          const searchableText = searchableFields.join(" ").toLowerCase();
          const queryWords = query.split(" ").filter((word) => word.length > 0);

          return queryWords.every((word) => searchableText.includes(word));
        });
      }

      function displayFilteredCapaian() {
        const tbody = document.querySelector("#capaian-table tbody");
        const searchStats = document.getElementById("searchCapaianStats");

        if (!tbody) return;

        let filteredData = filterCapaianData(allCapaianData);

        if (searchCapaianQuery && searchCapaianQuery.length > 0) {
          filteredData = searchCapaian(filteredData, searchCapaianQuery);
        }

        // Sort data by date and time (descending)
        filteredData = sortAgendaByDateTime(filteredData);

        tbody.innerHTML = "";

        if (filteredData.length === 0) {
          const noResultsMessage = searchCapaianQuery
            ? `Tidak ditemukan agenda yang sesuai dengan "${searchCapaianQuery}"`
            : "Tidak ada agenda untuk filter yang dipilih";

          tbody.innerHTML = `
      <tr>
        <td colspan="6" class="no-results">
          <div class="no-results-icon">📋</div>
          <div>${noResultsMessage}</div>
        </td>
      </tr>
    `;

          updateCapaianSearchStats(searchStats, 0, allCapaianData.length);
          return;
        }

// Debug log untuk melihat status setiap item
console.log('Filtered capaian data:', filteredData.map(item => ({
  id: item.id,
  agenda: item.agenda,
  status: item.status
})));

filteredData.forEach((row) => {
  const statusBadge = getStatusBadge(row.status || "belum_selesai");

          const tr = document.createElement("tr");
          tr.innerHTML = `
      <td title="${formatDate(row.tanggal)}">${highlightText(
            formatDate(row.tanggal),
            searchCapaianQuery
          )}</td>
      <td title="${row.jam}">${highlightText(row.jam, searchCapaianQuery)}</td>
      <td title="${row.agenda}">${highlightText(
            row.agenda,
            searchCapaianQuery
          )}</td>
      <td title="${row.pic || "Tidak ada PIC"}">${highlightText(
            row.pic || "Tidak ada PIC",
            searchCapaianQuery
          )}</td>
      <td>${statusBadge}</td>
<td>
  ${row.status === 'selesai' 
    ? `<button onclick='viewCapaianDetail(${JSON.stringify(row).replace(/'/g, "&#39;")})' class="btn btn-secondary">Detail</button>`
    : `<button onclick='updateCapaian(${JSON.stringify(row).replace(/'/g, "&#39;")})' class="btn btn-primary">Update</button>`
  }
</td>
    `;
          tbody.appendChild(tr);
        });

        updateCapaianSearchStats(
          searchStats,
          filteredData.length,
          allCapaianData.length
        );
      }

      function viewCapaianDetail(data) {
  console.log("View capaian detail for ID:", data.id);
  
  if (!data || !data.id) {
    showToast("Data agenda tidak valid!", "error");
    return;
  }
  
  showSection("capaian");
  const form = document.getElementById("capaianForm");
  
  if (!form) {
    showToast("Form tidak ditemukan!", "error");
    return;
  }
  
  form.classList.remove("hidden");

  // Fill form data dalam mode read-only
  document.getElementById('capaian-id').value = data.id;
  document.getElementById('capaian-agenda').value = data.agenda || '';
  document.getElementById('capaian-tanggal').value = formatDate(data.tanggal) || '';
  document.getElementById('capaian-pic').value = data.pic || 'Tidak ada PIC';
  document.getElementById('capaian-status').value = data.status || 'belum_selesai';
  document.getElementById('capaian-keterangan').value = data.keterangan || '';

  // Disable all form inputs untuk mode detail
  const formInputs = form.querySelectorAll('input, select, textarea');
  formInputs.forEach(input => {
    input.disabled = true;
    input.style.background = '#f5f5f5';
  });

// Hide file input untuk mode detail, tapi tetap tampilkan preview foto
const fotoInput = document.getElementById('capaian-foto').closest('.form-group');
if (fotoInput) {
  // Hanya sembunyikan input file, bukan seluruh form group
  const fileInput = document.getElementById('capaian-foto');
  const fileLabel = fotoInput.querySelector('label');
  const fileSmall = fotoInput.querySelector('small');
  
  if (fileInput) fileInput.style.display = 'none';
  if (fileLabel) fileLabel.style.display = 'none';
  if (fileSmall) fileSmall.style.display = 'none';
}

  // Handle existing photo display
  const currentFoto = document.getElementById("current-foto");
  const currentFotoPreview = document.getElementById("current-foto-preview");
  // Ubah label foto untuk mode detail
const currentFotoElement = document.getElementById("current-foto");
if (currentFotoElement) {
  const fotoLabel = currentFotoElement.querySelector('p');
  if (fotoLabel) {
    fotoLabel.textContent = 'Dokumentasi:';
  }
}

  if (currentFoto && currentFotoPreview) {
    if (data.foto) {
      currentFoto.classList.remove("hidden");
      currentFotoPreview.src = data.foto;
      // Show foto dengan ukuran lebih besar untuk detail view
      currentFotoPreview.style.maxWidth = '400px';
      currentFotoPreview.style.maxHeight = '300px';
    } else {
      currentFoto.classList.add("hidden");
    }
  }

  // Update form header
  const formHeader = form.querySelector('h3');
  if (formHeader) {
    formHeader.textContent = 'Detail Capaian Agenda';
  }

// Hide submit button
  const submitBtn = form.querySelector('button[type="submit"]');
  if (submitBtn) {
    submitBtn.style.display = 'none';
  }

  // Update button container untuk mode detail
  const buttonContainer = form.querySelector('button[type="submit"]').parentNode;
  buttonContainer.innerHTML = `
    <div class="print-buttons">
      <button type="button" class="btn btn-success" onclick="cetakLaporan(${data.id})">
        📄 Cetak PDF
      </button>
      <button type="button" class="btn btn-secondary" onclick="cancelCapaian()">
        Tutup
      </button>
    </div>
  `;

  // Scroll to form
  setTimeout(() => {
    form.scrollIntoView({
      behavior: "smooth",
      block: "start",
    });
  }, 100);
}

      function getStatusBadge(status) {
        const statusMap = {
          selesai: { text: "Selesai", class: "status-selesai" },
          ditunda: { text: "Ditunda", class: "status-ditunda" },
          batal: { text: "Batal", class: "status-batal" },
          belum_selesai: {
            text: "Belum Selesai",
            class: "status-belum_selesai",
          },
        };

        const statusInfo = statusMap[status] || statusMap["belum_selesai"];
        return `<span class="status-badge ${statusInfo.class}">${statusInfo.text}</span>`;
      }

// ===== CLEANED UP CAPAIAN FUNCTIONS =====

// Remove the debug function call that's causing errors
document.addEventListener("DOMContentLoaded", function() {
  // Remove this line: testAPIConnection();
  
  // Keep only essential initialization
  loadDashboardStats();
  initSearch();
});

// Simplified updateCapaian function
function updateCapaian(data) {
  console.log("Update capaian called for ID:", data.id);
  
  if (!data || !data.id) {
    showToast("Data agenda tidak valid!", "error");
    return;
  }
  
  showSection("capaian");
  const form = document.getElementById("capaianForm");
  
  if (!form) {
    showToast("Form tidak ditemukan!", "error");
    return;
  }

  // TAMBAHKAN: Reset form ke mode normal dulu
  const formInputs = form.querySelectorAll('input, select, textarea');
  formInputs.forEach(input => {
    input.disabled = false;
    input.style.background = '';
  });

  // Show file input
  const fotoInput = document.getElementById('capaian-foto').closest('.form-group');
  if (fotoInput) {
    fotoInput.style.display = '';
  }

  // Reset form header
  const formHeader = form.querySelector('h3');
  if (formHeader) {
    formHeader.textContent = 'Update Capaian Agenda';
  }

  // Show submit button
  const submitBtn = form.querySelector('button[type="submit"]');
  if (submitBtn) {
    submitBtn.style.display = '';
  }

  // Reset cancel button text
  const cancelBtn = form.querySelector('button.btn-secondary');
  if (cancelBtn) {
    cancelBtn.textContent = 'Batal';
  }

  form.classList.remove("hidden");

  // Fill form data
  document.getElementById('capaian-id').value = data.id;
  document.getElementById('capaian-agenda').value = data.agenda || '';
  document.getElementById('capaian-tanggal').value = formatDate(data.tanggal) || '';
  document.getElementById('capaian-pic').value = data.pic || 'Tidak ada PIC';
  document.getElementById('capaian-status').value = data.status || 'belum_selesai';
  document.getElementById('capaian-keterangan').value = data.keterangan || '';

  // Handle existing photo
  const currentFoto = document.getElementById("current-foto");
  const currentFotoPreview = document.getElementById("current-foto-preview");

  if (currentFoto && currentFotoPreview) {
    if (data.foto) {
      currentFoto.classList.remove("hidden");
      currentFotoPreview.src = data.foto;
      // Reset ukuran foto ke normal untuk update mode
      currentFotoPreview.style.maxWidth = '200px';
      currentFotoPreview.style.maxHeight = '150px';
    } else {
      currentFoto.classList.add("hidden");
    }
  }

  // Scroll to form
  setTimeout(() => {
    form.scrollIntoView({
      behavior: "smooth",
      block: "start",
    });
  }, 100);
}

// Keep the existing helper functions as they are
function cancelCapaian() {
  const form = document.getElementById("capaianForm");
  
  // Reset form ke mode normal (enable semua input)
  if (form) {
    const formInputs = form.querySelectorAll('input, select, textarea');
    formInputs.forEach(input => {
      input.disabled = false;
      input.style.background = '';
    });

// Show kembali file input
const fotoInput = document.getElementById('capaian-foto').closest('.form-group');
if (fotoInput) {
  // Tampilkan kembali semua elemen form file
  const fileInput = document.getElementById('capaian-foto');
  const fileLabel = fotoInput.querySelector('label');
  const fileSmall = fotoInput.querySelector('small');
  
  if (fileInput) fileInput.style.display = '';
  if (fileLabel) fileLabel.style.display = '';
  if (fileSmall) fileSmall.style.display = '';
}

    // Reset form header
    const formHeader = form.querySelector('h3');
    if (formHeader) {
      formHeader.textContent = 'Update Capaian Agenda';
    }

    // Show kembali submit button
    const submitBtn = form.querySelector('button[type="submit"]');
    if (submitBtn) {
      submitBtn.style.display = '';
    }

    // Reset cancel button text
    const cancelBtn = form.querySelector('button.btn-secondary');
    if (cancelBtn) {
      cancelBtn.textContent = 'Batal';
    }

    // Reset foto preview size
    const currentFotoPreview = document.getElementById("current-foto-preview");
    if (currentFotoPreview) {
      currentFotoPreview.style.maxWidth = '200px';
      currentFotoPreview.style.maxHeight = '150px';
    }
  }

  document.getElementById("capaianForm").classList.add("hidden");
  document.getElementById("capaian-foto").value = "";
  setTimeout(() => {
    window.scrollTo({
      top: 0,
      behavior: "smooth",
    });
  }, 100);

  // Reset label foto
const currentFotoElement = document.getElementById("current-foto");
if (currentFotoElement) {
  const fotoLabel = currentFotoElement.querySelector('p');
  if (fotoLabel) {
    fotoLabel.textContent = 'Foto saat ini:';
  }
}
}

function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = (error) => reject(new Error("Gagal membaca file"));
    reader.readAsDataURL(file);
  });
}function debugCapaianForm() {
  console.log("=== DEBUGGING CAPAIAN FORM ===");
  
  const formElements = [
    'capaian-id',
    'capaian-agenda', 
    'capaian-tanggal',
    'capaian-pic',
    'capaian-status',
    'capaian-keterangan',
    'capaian-foto'
  ];
  
  formElements.forEach(id => {
    const element = document.getElementById(id);
    if (element) {
      console.log(`${id}: ${element.value || element.files?.length || 'empty'}`);
    } else {
      console.error(`Missing element: ${id}`);
    }
  });
  
  console.log("All capaian data:", allCapaianData.length, "items");
  console.log("Current filter:", currentCapaianFilter);
  console.log("Search query:", searchCapaianQuery);
}


async function submitCapaian(e) {
  e.preventDefault();
  const submitBtn = e.target.querySelector('button[type="submit"]');
  setButtonLoading(submitBtn, true, "Menyimpan...");

  const id = document.getElementById("capaian-id").value;
  const status = document.getElementById("capaian-status").value;
  const keterangan = document.getElementById("capaian-keterangan").value;
  const fotoFile = document.getElementById("capaian-foto").files[0];

  console.log("=== DEBUG SUBMIT CAPAIAN START ===");
  console.log("Form elements:");
  console.log("- ID:", id, typeof id);
  console.log("- Status:", status, typeof status);
  console.log("- Keterangan:", keterangan, typeof keterangan);
  console.log("- File:", fotoFile ? fotoFile.name : "No file");

  // Validasi ID
  if (!id || isNaN(parseInt(id))) {
    console.error("Invalid ID:", id);
    showToast("ID agenda tidak valid!", "error");
    setButtonLoading(submitBtn, false);
    return;
  }

  // Validasi status
  const validStatuses = ['selesai', 'ditunda', 'batal', 'belum_selesai'];
  if (!validStatuses.includes(status)) {
    console.error("Invalid status:", status);
    showToast("Status tidak valid!", "error");
    setButtonLoading(submitBtn, false);
    return;
  }

  try {
    let fotoData = null;

    // Handle file upload if exists
    if (fotoFile) {
      console.log("Processing file upload...");
      
      // Validate file size (5MB max)
      if (fotoFile.size > 5 * 1024 * 1024) {
        showToast("Ukuran file terlalu besar! Maksimal 5MB", "error");
        setButtonLoading(submitBtn, false);
        return;
      }

      // Validate file type
      const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
      if (!allowedTypes.includes(fotoFile.type)) {
        showToast("Format file tidak didukung! Gunakan JPG, PNG, atau GIF", "error");
        setButtonLoading(submitBtn, false);
        return;
      }

      try {
        fotoData = await fileToBase64(fotoFile);
        console.log("File converted to base64, length:", fotoData.length);
      } catch (error) {
        console.error("Error converting file:", error);
        showToast("Gagal memproses file gambar!", "error");
        setButtonLoading(submitBtn, false);
        return;
      }
    }

    // Ambil data agenda yang sudah ada terlebih dahulu
    const currentAgenda = allCapaianData.find((item) => item.id == id);
    if (!currentAgenda) {
      console.error("Current agenda not found for ID:", id);
      console.log("Available agenda IDs:", allCapaianData.map(item => item.id));
      console.log("All capaian data length:", allCapaianData.length);
      
      // Coba reload data dulu sebelum gagal
      console.log("Attempting to reload data...");
      await loadCapaian();
      
      // Coba cari lagi setelah reload
      const reloadedAgenda = allCapaianData.find((item) => item.id == id);
      if (!reloadedAgenda) {
        showToast("Data agenda tidak ditemukan setelah reload!", "error");
        setButtonLoading(submitBtn, false);
        return;
      }
      console.log("Found agenda after reload:", reloadedAgenda);
      currentAgenda = reloadedAgenda;
    }

    console.log("Current agenda found:", {
      id: currentAgenda.id,
      agenda: currentAgenda.agenda,
      status: currentAgenda.status
    });

    // Prepare data untuk dikirim
    const updateData = {
      id: parseInt(id),
      tanggal: currentAgenda.tanggal,
      jam: currentAgenda.jam,
      agenda: currentAgenda.agenda,
      pic: currentAgenda.pic,
      tempat: currentAgenda.tempat,
      status: status,
      keterangan: keterangan || null, // Allow empty keterangan
    };

    // Only include foto if there's new upload or existing foto
    if (fotoData) {
      updateData.foto = fotoData;
    } else if (currentAgenda.foto) {
      updateData.foto = currentAgenda.foto; // Keep existing foto
    }

    console.log("=== DATA TO BE SENT ===");
    console.log("Update data:", {
      ...updateData,
      foto: updateData.foto ? `[Base64 data - ${updateData.foto.length} chars]` : 'null'
    });

    // Send request
    console.log("Sending PATCH request to /api/edit-agenda...");
    const response = await fetch("/api/edit-agenda", {
      method: "PATCH",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(updateData),
    });

    console.log("=== RESPONSE RECEIVED ===");
    console.log("Status:", response.status);
    console.log("Status text:", response.statusText);
    console.log("Headers:", Object.fromEntries(response.headers.entries()));

    // Get response text first for debugging
    const responseText = await response.text();
    console.log("Raw response text:", responseText);

    // Check if response is ok
    if (!response.ok) {
      console.error("Server error response:", responseText);
      
      let errorMessage = `HTTP ${response.status}: ${response.statusText}`;
      
      // Try to parse error message from response
      try {
        const errorJson = JSON.parse(responseText);
        if (errorJson.error) {
          errorMessage = errorJson.error;
        }
        if (errorJson.details) {
          errorMessage += ` (${errorJson.details})`;
        }
      } catch (e) {
        console.log("Response is not valid JSON, using raw text");
        if (responseText) {
          errorMessage = responseText;
        }
      }
      
      throw new Error(errorMessage);
    }

    // Parse successful response
    let result;
    try {
      result = JSON.parse(responseText);
      console.log("Parsed response:", result);
    } catch (e) {
      console.warn("Response is not JSON but request was successful:", responseText);
      result = { success: true, message: "Update berhasil" };
    }

    // Check for application-level errors
    if (result.error) {
      throw new Error(result.error);
    }

    console.log("=== UPDATE SUCCESSFUL ===");
    showToast("Capaian agenda berhasil diupdate!", "success");
    
    // Cancel form
    cancelCapaian();
    
    // Reload data dengan delay untuk memastikan server sudah update
    console.log("Reloading data...");
    setTimeout(async () => {
      try {
        await loadCapaian();
        await loadDashboardStats();
        console.log("Data reloaded successfully");
      } catch (error) {
        console.error("Error reloading data:", error);
      }
    }, 500);

    // Scroll to top
    setTimeout(() => {
      window.scrollTo({
        top: 0,
        behavior: "smooth",
      });
    }, 200);

  } catch (error) {
    console.error("=== ERROR SUBMIT CAPAIAN ===");
    console.error("Error message:", error.message);
    console.error("Error stack:", error.stack);
    
    let errorMessage = "Gagal mengupdate capaian";
    if (error.message && !error.message.includes('Failed to fetch')) {
      errorMessage += `: ${error.message}`;
    } else if (error.message && error.message.includes('Failed to fetch')) {
      errorMessage = "Gagal terhubung ke server. Periksa koneksi internet Anda.";
    }
    
    showToast(errorMessage, "error");
  } finally {
    setButtonLoading(submitBtn, false);
    console.log("=== DEBUG SUBMIT CAPAIAN END ===");
  }
}


function cancelCapaian() {
        document.getElementById("capaianForm").classList.add("hidden");
        document.getElementById("capaian-foto").value = "";
        setTimeout(() => {
          window.scrollTo({
            top: 0,
            behavior: "smooth",
          });
        }, 100);
      }

      // Reset button container
    const form = document.getElementById("capaianForm");
    if (form) {
      const buttonContainer = form.querySelector('.print-buttons');
      if (buttonContainer) {
        buttonContainer.parentNode.innerHTML = `
          <button type="submit" class="btn btn-primary">Simpan Capaian</button>
          <button type="button" class="btn btn-secondary" onclick="cancelCapaian()">Batal</button>
        `;
      }
    }

      // Helper function to convert file to base64
function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    console.log("Converting file to base64:", file.name, file.size, "bytes");
    
    const reader = new FileReader();
    
    reader.onload = () => {
      console.log("File conversion successful");
      resolve(reader.result);
    };
    
    reader.onerror = (error) => {
      console.error("File conversion error:", error);
      reject(new Error("Gagal membaca file"));
    };
    
    reader.onabort = () => {
      console.error("File conversion aborted");
      reject(new Error("Pembacaan file dibatalkan"));
    };
    
    try {
      reader.readAsDataURL(file);
    } catch (error) {
      console.error("Error starting file read:", error);
      reject(error);
    }
  });
}

function cetakLaporan(agendaId) {
  try {
    // Cari data agenda berdasarkan ID
    const agenda = allCapaianData.find(item => item.id == agendaId);
    
    if (!agenda) {
      showToast("Data agenda tidak ditemukan!", "error");
      return;
    }

    // Initialize jsPDF
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    // Set font
    doc.setFont("helvetica");
    
    // Header
    doc.setFontSize(18);
    doc.setTextColor(40);
    doc.text("LAPORAN CAPAIAN AGENDA", 105, 20, { align: "center" });
    
    // Line separator
    doc.setDrawColor(100);
    doc.line(20, 25, 190, 25);
    
    // Content
    doc.setFontSize(12);
    doc.setTextColor(60);
    
    let yPosition = 40;
    const lineHeight = 8;
    
    // Informasi Agenda
    doc.setFont("helvetica", "bold");
    doc.text("INFORMASI AGENDA:", 20, yPosition);
    yPosition += lineHeight + 2;
    
    doc.setFont("helvetica", "normal");
    doc.text(`Agenda: ${agenda.agenda || 'Tidak ada agenda'}`, 25, yPosition);
    yPosition += lineHeight;
    
    doc.text(`Tanggal: ${formatDate(agenda.tanggal)}`, 25, yPosition);
    yPosition += lineHeight;
    
    doc.text(`Waktu: ${agenda.jam || 'Tidak ada waktu'}`, 25, yPosition);
    yPosition += lineHeight;
    
    doc.text(`PIC: ${agenda.pic || 'Tidak ada PIC'}`, 25, yPosition);
    yPosition += lineHeight;
    
    doc.text(`Tempat: ${agenda.tempat || 'Tidak ada lokasi'}`, 25, yPosition);
    yPosition += lineHeight + 5;
    
    // Status Capaian
    doc.setFont("helvetica", "bold");
    doc.text("STATUS CAPAIAN:", 20, yPosition);
    yPosition += lineHeight + 2;
    
    doc.setFont("helvetica", "normal");
    const statusText = getStatusText(agenda.status || 'belum_selesai');
    doc.text(`Status: ${statusText}`, 25, yPosition);
    yPosition += lineHeight + 5;
    
    // Keterangan
    if (agenda.keterangan) {
      doc.setFont("helvetica", "bold");
      doc.text("KETERANGAN:", 20, yPosition);
      yPosition += lineHeight + 2;
      
      doc.setFont("helvetica", "normal");
      
      // Split keterangan jika terlalu panjang
      const splitKeterangan = doc.splitTextToSize(agenda.keterangan, 160);
      splitKeterangan.forEach(line => {
        doc.text(line, 25, yPosition);
        yPosition += lineHeight;
      });
      yPosition += 5;
    }
    
    // Dokumentasi Foto
    if (agenda.foto) {
      doc.setFont("helvetica", "bold");
      doc.text("DOKUMENTASI:", 20, yPosition);
      yPosition += lineHeight + 2;
      
      try {
        // Tambahkan foto ke PDF
        const imgWidth = 80;
        const imgHeight = 60;
        
        doc.addImage(agenda.foto, 'JPEG', 25, yPosition, imgWidth, imgHeight);
        yPosition += imgHeight + 10;
      } catch (error) {
        console.warn("Gagal menambahkan foto ke PDF:", error);
        doc.setFont("helvetica", "italic");
        doc.text("(Foto tidak dapat ditampilkan)", 25, yPosition);
        yPosition += lineHeight + 5;
      }
    }
    
    // Footer
    const today = new Date();
    const footerText = `Dicetak pada: ${today.toLocaleDateString('id-ID')} ${today.toLocaleTimeString('id-ID')}`;
    
    doc.setFont("helvetica", "italic");
    doc.setFontSize(10);
    doc.setTextColor(100);
    doc.text(footerText, 105, 280, { align: "center" });
    
    // Simpan PDF
    const fileName = `Laporan_Agenda_${agenda.id}_${agenda.tanggal.replace(/-/g, '')}.pdf`;
    doc.save(fileName);
    
    showToast("Laporan PDF berhasil dibuat!", "success");
    
  } catch (error) {
    console.error("Error creating PDF:", error);
    showToast("Gagal membuat laporan PDF!", "error");
  }
}

function getStatusText(status) {
  const statusMap = {
    'selesai': 'Selesai',
    'ditunda': 'Ditunda', 
    'batal': 'Batal',
    'belum_selesai': 'Belum Selesai'
  };
  
  return statusMap[status] || 'Belum Selesai';
}



      // ===== CAPAIAN SEARCH FUNCTIONS =====
      function initCapaianSearch() {
        const searchInput = document.getElementById("searchCapaianInput");
        const searchClear = document.getElementById("searchCapaianClear");

        if (!searchInput || !searchClear) return;

        searchInput.addEventListener("input", handleCapaianSearchInput);
        searchClear.style.display = "none";
      }

      const handleCapaianSearchInput = debounce(function (event) {
        searchCapaianQuery = event.target.value.toLowerCase().trim();
        const searchClear = document.getElementById("searchCapaianClear");

        if (searchCapaianQuery.length > 0) {
          searchClear.style.display = "block";
        } else {
          searchClear.style.display = "none";
        }

        displayFilteredCapaian();
      }, 300);

      function clearCapaianSearch() {
        const searchInput = document.getElementById("searchCapaianInput");
        const searchClear = document.getElementById("searchCapaianClear");
        const searchStats = document.getElementById("searchCapaianStats");

        if (searchInput) searchInput.value = "";
        if (searchClear) searchClear.style.display = "none";
        if (searchStats) searchStats.textContent = "";

        searchCapaianQuery = "";
        displayFilteredCapaian();
      }

      function updateCapaianSearchStats(searchStats, totalResults, totalData) {
        if (!searchStats) return;

        if (searchCapaianQuery && searchCapaianQuery.length > 0) {
          searchStats.textContent = `Menampilkan ${totalResults} dari ${totalData} agenda`;
        } else {
          searchStats.textContent = "";
        }
      }

      // ===== UPDATE EXISTING SHOWSECTION FUNCTION =====

      // ===== PRINT REPORT FUNCTIONS =====
let selectedPrintType = null;

function showPrintDialog() {
  document.getElementById('printOverlay').style.display = 'block';
  document.getElementById('printDialog').style.display = 'block';
  document.body.style.overflow = 'hidden';
}

function closePrintDialog() {
  document.getElementById('printOverlay').style.display = 'none';
  document.getElementById('printDialog').style.display = 'none';
  document.body.style.overflow = 'auto';
  
  // Reset selection
  document.querySelectorAll('.print-option').forEach(option => {
    option.classList.remove('selected');
  });
  selectedPrintType = null;
  document.getElementById('printBtn').disabled = true;
  document.getElementById('categoryInfo').style.display = 'none';
}

function selectPrintOption(type) {
  // Remove previous selection
  document.querySelectorAll('.print-option').forEach(option => {
    option.classList.remove('selected');
  });
  
  // Add selection to current option
  document.querySelector(`[data-type="${type}"]`).classList.add('selected');
  selectedPrintType = type;
  
  // Enable print button
  document.getElementById('printBtn').disabled = false;
  
  // Show preview
  showCategoryPreview(type);
}

function showCategoryPreview(type) {
  const categoryInfo = document.getElementById('categoryInfo');
  const categoryPreview = document.getElementById('categoryPreview');
  
  let filteredData = [];
  let description = '';
  
  switch(type) {
    case 'weekly':
      filteredData = getWeeklyData();
      description = `${filteredData.length} agenda dalam 7 hari ke depan`;
      break;
    case 'rapat':
      filteredData = getCategoryData('rapat');
      description = `${filteredData.length} agenda rapat ditemukan`;
      break;
    case 'perdin':
      filteredData = getCategoryData('perdin');
      description = `${filteredData.length} agenda perjalanan dinas ditemukan`;
      break;
    case 'bimtek':
      filteredData = getCategoryData('bimtek');
      description = `${filteredData.length} agenda bimbingan teknis ditemukan`;
      break;
  }
  
  categoryPreview.textContent = description;
  categoryInfo.style.display = 'block';
}

function getWeeklyData() {
  const today = new Date();
  const weekLater = new Date();
  weekLater.setDate(today.getDate() + 7);
  
  const todayStr = today.toISOString().split('T')[0];
  const weekLaterStr = weekLater.toISOString().split('T')[0];
  
  return allCapaianData.filter(item => {
    return item.tanggal >= todayStr && item.tanggal <= weekLaterStr;
  });
}

function getCategoryData(category) {
  switch(category) {
    case 'rapat':
      return allCapaianData.filter(item => {
        const agenda = (item.agenda || '').toLowerCase();
        return agenda.includes('rapat');
      });
    
    case 'perdin':
      return allCapaianData.filter(item => {
        const tempat = (item.tempat || '').toLowerCase();
        const keywords = ['kanwil', 'kantor wilayah', 'jl.', 'jl ', 'semarang', 'batang', 'pekalongan'];
        return keywords.some(keyword => tempat.includes(keyword));
      });
    
    case 'bimtek':
      return allCapaianData.filter(item => {
        const agenda = (item.agenda || '').toLowerCase();
        return agenda.includes('bimbingan teknis') || agenda.includes('bimtek');
      });
    
    default:
      return [];
  }
}

async function executePrint() {
  if (!selectedPrintType) return;
  
  const printBtn = document.getElementById('printBtn');
  setButtonLoading(printBtn, true, 'Menyiapkan...');
  
  try {
    // Get data based on selection
    let printData = [];
    let reportTitle = '';
    
    switch(selectedPrintType) {
      case 'weekly':
        printData = getWeeklyData();
        reportTitle = 'Laporan Agenda Mingguan';
        break;
      case 'rapat':
        printData = getCategoryData('rapat');
        reportTitle = 'Laporan Agenda Rapat';
        break;
      case 'perdin':
        printData = getCategoryData('perdin');
        reportTitle = 'Laporan Agenda Perjalanan Dinas';
        break;
      case 'bimtek':
        printData = getCategoryData('bimtek');
        reportTitle = 'Laporan Agenda Bimbingan Teknis';
        break;
    }
    
    if (printData.length === 0) {
      showToast('Tidak ada data untuk dicetak!', 'warning');
      return;
    }
    
    // Sort data by date
    printData = sortAgendaByDateTime(printData);
    
    // Generate print content
    generatePrintReport(printData, reportTitle);
    
    closePrintDialog();
    
  } catch (error) {
    console.error('Error generating print:', error);
    showToast('Gagal menyiapkan laporan!', 'error');
  } finally {
    setButtonLoading(printBtn, false);
  }
}

function generatePrintReport(data, title) {
  // Create new window for printing
  const printWindow = window.open('', '_blank');
  
  const today = new Date();
  const formattedDate = today.toLocaleDateString('id-ID', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
  
  let tableRows = '';
  data.forEach((item, index) => {
    const statusText = getStatusText(item.status);
    tableRows += `
      <tr>
        <td style="text-align: center;">${index + 1}</td>
        <td>${formatDate(item.tanggal)}</td>
        <td>${item.jam || '-'}</td>
        <td>${item.agenda || '-'}</td>
        <td>${item.pic || '-'}</td>
        <td>${item.tempat || '-'}</td>
        <td style="text-align: center;">${statusText}</td>
      </tr>
    `;
  });
  
  const htmlContent = `
    <!DOCTYPE html>
    <html>
    <head>
      <title>${title}</title>
      <style>
        body { font-family: Arial, sans-serif; margin: 20px; color: #333; }
        .print-header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #000; padding-bottom: 20px; }
        .print-header h1 { margin: 0; font-size: 24px; }
        .print-header p { margin: 5px 0 0 0; color: #666; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f5f5f5; font-weight: bold; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .print-footer { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 15px; font-size: 12px; text-align: right; }
        .summary { background: #f0f8ff; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
      </style>
    </head>
    <body>
      <div class="print-header">
        <h1>${title}</h1>
        <p>Dicetak pada: ${formattedDate}</p>
      </div>
      
      <div class="summary">
        <strong>Ringkasan:</strong> Total ${data.length} agenda
      </div>
      
      <table>
        <thead>
          <tr>
            <th style="width: 5%;">No</th>
            <th style="width: 15%;">Tanggal</th>
            <th style="width: 10%;">Jam</th>
            <th style="width: 30%;">Agenda</th>
            <th style="width: 15%;">PIC</th>
            <th style="width: 15%;">Tempat</th>
            <th style="width: 10%;">Status</th>
          </tr>
        </thead>
        <tbody>
          ${tableRows}
        </tbody>
      </table>
      
      <div class="print-footer">
        <p>Agenda Kita (AKITA) - Sistem Manajemen Agenda Kantor</p>
      </div>
    </body>
    </html>
  `;
  
  printWindow.document.write(htmlContent);
  printWindow.document.close();
  
  // Auto print when loaded
  printWindow.onload = function() {
    printWindow.print();
    printWindow.close();
  };
}

function getStatusText(status) {
  const statusMap = {
    'selesai': 'Selesai',
    'ditunda': 'Ditunda', 
    'batal': 'Batal',
    'belum_selesai': 'Belum Selesai'
  };
  return statusMap[status] || 'Belum Selesai';
}
      // ===== EVENT LISTENERS =====
      document.addEventListener("DOMContentLoaded", function () {
        document.getElementById('printOverlay').addEventListener('click', closePrintDialog);
        loadDashboardStats();
        initSearch();
      });

      document.querySelectorAll(".nav-link").forEach((link) => {
        link.addEventListener("click", () => {
          if (window.innerWidth <= 1024) {
            closeSidebar();
          }
        });
      });

      window.addEventListener("resize", () => {
        if (window.innerWidth > 1024) {
          closeSidebar();
        }
      });
    </script>
  </body>
</html>

